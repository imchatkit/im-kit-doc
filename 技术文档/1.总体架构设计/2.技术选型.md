## 项目管理

##### 任务管理

- **工具**: TAPD
- **开发模式**: 敏捷开发，采用版本迭代方式
- **进度跟踪**: 使用甘特图（Excel）
- **缺陷管理**: 禅道

##### 代码分支管理

- **工具**: GitLab
- **管理规范**: 参考《分支管理规范文档》

##### 文档知识库

- **工具**: 自建文档存储系统  / 企业微信文档

##  前端技术选型（跨平台）

1. **核心库开发**
   - **语言**：Go (Golang)
   - **功能**：开发WebSocket连接、消息收发、心跳机制的基础核心代码，打包成动态库，供其他语言使用。
   - **优势**：实现跨平台开发，增加代码复用，减少开发成本，提高开发效率。

2. **移动端开发**
   - **框架**：Flutter
   - **依赖**：依赖Go核心库，编译出Android和iOS的应用。
   - **优势**：Flutter可以实现跨平台开发，减少开发成本，提高开发效率。

3. **Web端开发**
   - **核心业务逻辑**：使用Go语言编译出WebAssembly (WASM)，通过JavaScript调用WASM实现核心业务逻辑。
   - **UI层**：使用Vue.js框架，实现丰富的用户界面和交互体验。

4. **桌面端开发**
   - **框架**：Electron
   - **依赖**：依赖Web端的代码，使用Electron跨平台开发框架，编译出Windows、macOS、Linux等桌面可运行程序。
   - **优势**：Electron可以复用Web端的代码，减少开发工作量。

## IM core后端技术选型

java版本： jdk17（主流） 贝尔实验室 Spring 官方推荐https://bell-sw.com/pages/downloads/

基础框架版本：

spring-boot.version:3.2.9

spring-cloud.version=2023.0.3



### 基础中间件

关系型数据库：mysql  5.7 可无缝兼容升级-> tidb

nosql非关系型数据库： mongoDB

消息文本搜索引擎：ES （分词）

缓存：redis

消息队列: rocketmq

分布式ID生成：leaf

文件图片存储： 

- 云对象存储(云存储方便对接CDN加速)， 

- 自建文件系统例如minIO， fastDFS（接入cdn复杂，研发时间较长）



## 后端选型

1. **语言**：Java

   - **优势**：招聘人才多，适合本业务；Spring Cloud微服务生态强大，适合构建复杂的企业级应用。

2. **微服务框架**：Spring Cloud (Alibaba)

   - **服务注册与发现**：Nacos
   - **API网关**：Spring Cloud Gateway
   - **断路器**：Resilience4j
   - **声明式服务调用**：Dubbo
   - **配置中心**：Nacos
   - **分布式链路追踪**：SkyWalking
   - **日志收集**：ELK (Elasticsearch, Logstash, Kibana)
   - 流控：
   - 分布式锁：

3. **持久层存储**：MySQL 5.7（可无缝升级至TiDB）

   - **功能**：存储用户信息、聊天记录等持久化数据。
   - **优势**：成熟稳定，广泛使用，支持事务处理。

4. **缓存数据库**：Redis

   - **功能**：高性能内存缓存数据库，用于存储临时数据、会话信息等。
   - **优势**：读写速度快，支持数据持久化。

5. **消息队列**：RocketMQ

   - **功能**：流量削峰，异步处理消息，提高系统吞吐量。
   - **优势**：高可用、高性能，支持分布式部署。

6. **部署**：Docker

   - **功能**：容器化部署，实现弹性扩容伸缩。
   - **优势**：轻量级、隔离性强，易于管理和扩展。

   

   ## 全部依赖

   | 功能           | 本框架                                                       |
   | -------------- | ------------------------------------------------------------ |
   | 后端项目结构   | 采用插件化 + 扩展包形式 结构解耦 易于扩展                    |
   | 后端代码风格   | 严格遵守Alibaba规范与项目统一配置的代码格式化                |
   | 分布式注册中心 | 采用 Alibaba Nacos                                           |
   | 分布式配置中心 | 采用 Alibaba Nacos                                           |
   | 服务网关       | 采用 SpringCloud Gateway 框架扩展了多种功能 例如:内网鉴权、请求体缓存、跨域配置、请求响应日志等 |
   | 负载均衡       | 采用 SpringCloud Loadbalancer 扩展支持了开发团队路由 便于多团队开发调试 |
   | RPC远程调用    | 采用 全新 Apache Dubbo 3.X 历史悠远                          |
   | 分布式限流熔断 | 采用 Alibaba Sentinel 源码集成便于调试扩展与二次开发         |
   | 分布式事务     | 采用 Alibaba Seata 源码集成对接了Nacos与各种监控 简化了搭建部署流程 |
   | Web容器        | 采用 Undertow 基于 XNIO 的高性能容器                         |
   | 权限认证       | 采用 Sa-Token、Jwt 静态使用功能齐全 低耦合 高扩展            |
   | 权限注解       | 采用 Sa-Token 支持注解 登录校验、角色校验、权限校验、二级认证校验、HttpBasic校验、忽略校验 角色与权限校验支持多种条件 如 `AND` `OR` 或 `权限 OR 角色` 等复杂表达式 |
   | 关系数据库支持 | 原生支持 MySQL、Oracle、PostgreSQL、SQLServer 可同时使用异构切换(支持其他 mybatis-plus 支持的所有数据库 只需要增加jdbc依赖即可使用 达梦金仓等均有成功案例) |
   | 缓存数据库     | 支持 Redis 5-7 支持大部分新功能特性 如 分布式限流、分布式队列 |
   | Redis客户端    | 采用 Redisson Redis官方推荐 基于Netty的客户端工具 支持Redis 90%以上的命令 底层优化规避很多不正确的用法 例如: keys被转换为scan 支持单机、哨兵、单主集群、多主集群等模式 |
   | 缓存注解       | 采用 Spring-Cache 注解 对其扩展了实现支持了更多功能 例如 过期时间 最大空闲时间 组最大长度等 只需一个注解即可完成数据自动缓存 |
   | ORM框架        | 采用 Mybatis-Plus 基于对象几乎不用写SQL全java操作 功能强大插件众多 例如多租户插件 分页插件 乐观锁插件等等 |
   | SQL监控        | 采用 p6spy 可输出完整SQL与执行时间监控                       |
   | 数据分页       | 采用 Mybatis-Plus 分页插件 框架对其进行了扩展 对象化分页对象 支持多种方式传参 支持前端多排序 复杂排序 |
   | 数据权限       | 采用 Mybatis-Plus 插件 自行分析拼接SQL 无感式过滤 只需为Mapper设置好注解条件 支持多种自定义 不限于部门角色 |
   | 数据脱敏       | 采用 注解 + jackson 序列化期间脱敏 支持不同模块不同的脱敏条件 支持多种策略 如身份证、手机号、地址、邮箱、银行卡等 可自行扩展 |
   | 数据加解密     | 采用 注解 + mybatis 拦截器 对存取数据期间自动加解密 支持多种策略 如BASE64、AES、RSA、SM2、SM4等 |
   | 数据翻译       | 采用 注解 + jackson 序列化期间动态修改数据 数据进行翻译 支持多种模式: `映射翻译` `直接翻译` `其他扩展条件翻译` 接口化两步即可完成自定义扩展 内置多种翻译实现 |
   | 多数据源框架   | 采用 dynamic-datasource 支持市面大部分数据库 通过yml配置即可动态管理异构不同种类的数据库 也可通过前端页面添加数据源 支持spel表达式从请求头参数等条件切换数据源 |
   | 多数据源事务   | 采用 dynamic-datasource 支持多数据源不同种类的数据库事务回滚 |
   | 数据库连接池   | 采用 HikariCP Spring官方内置连接池 配置简单 以性能与稳定性闻名天下 |
   | 数据库主键     | 采用 雪花ID 基于时间戳的 有序增长 唯一ID 再也不用为分库分表 数据合并主键冲突重复而发愁 |
   | WebSocket协议  | 基于 Spring 封装的 WebSocket 协议 扩展了Token鉴权与分布式会话同步 不再只是基于单机的废物 |
   | SSE推送        | 采用 Spring SSE 实现 扩展了Token鉴权与分布式会话同步         |
   | 序列化         | 采用 Jackson Spring官方内置序列化 靠谱!!!                    |
   | 分布式幂等     | 参考美团GTIS防重系统简化实现(细节可看文档)                   |
   | 分布式任务调度 | 采用 SnailJob 天生支持分布式 统一的管理中心 支持多种数据库 支持分片重试DAG任务流等 |
   | 分布式日志中心 | 采用 ELK 业界成熟解决方案 实时收集所有服务的运行日志 快速发现定位问题 |
   | 分布式搜索引擎 | 采用 ElasticSearch、Easy-Es 以 Mybatis-Plus 方式操作 ElasticSearch |
   | 分布式消息队列 | 采用 支持 Kafka、RocketMQ、RabbitMQ 各种 延迟消息 事务消息 流消息 |
   | 分布式消息总线 | 采用 SpringCloud Bus 实现事件总线 跨服务通知 支持 Kafka、RocketMQ、RabbitMQ |
   | 分库分表功能   | 采用 Apache Sharding-Proxy 代理服务无入侵支持分库分表 只需编写分库分表规则即可 |
   | 文件存储       | 采用 Minio 分布式文件存储 天生支持多机、多硬盘、多分片、多副本存储 支持权限管理 安全可靠 文件可加密存储 |
   | 云存储         | 采用 AWS S3 协议客户端 支持 七牛、阿里、腾讯 等一切支持S3协议的厂家 |
   | 短信           | 支持 阿里、腾讯 只需在yml配置好厂家密钥即可使用 接口化支持扩展其他厂家 |
   | 邮件           | 采用 mail-api 通用协议支持大部分邮件厂商                     |
   | 接口文档       | 采用 SpringDoc、javadoc 无注解零入侵基于java注释 只需把注释写好 无需再写一大堆的文档注解了 |
   | 校验框架       | 采用 Validation 支持注解与工具类校验 注解支持国际化          |
   | Excel框架      | 采用 Alibaba EasyExcel 基于插件化 框架对其增加了很多功能 例如 自动合并相同内容 自动排列布局 字典翻译等 |
   | 工作流支持     | 支持各种复杂审批 转办 委派 加减签 会签 或签 票签 等功能      |
   | 工具类框架     | 采用 Hutool、Lombok 上百种工具覆盖90%的使用需求 基于注解自动生成 get set 等简化框架大量代码 |
   | 服务监控框架   | 采用 SpringBoot-Admin 基于SpringBoot官方 actuator 探针机制 实时监控服务状态 框架还为其扩展了在线日志查看监控 |
   | 全方位监控报警 | 采用 Prometheus、Grafana 多样化采集 多模板大屏展示 实时报警监控 提供详细的搭建文档 |
   | 链路追踪       | 采用 Apache SkyWalking 还在为请求不知道去哪了 到哪出了问题而烦恼吗 用了它即可实时查看请求经过的每一处每一个节点 |
   | 代码生成器     | 只需设计好表结构 一键生成所有crud代码与页面 降低80%的开发量 把精力都投入到业务设计上 框架为其适配MP、SpringDoc规范化代码 同时支持动态多数据源代码生成 |
   | 部署方式       | 支持 Docker 编排 一键搭建所有环境 让开发人员从此不再为搭建环境而烦恼 |
   | 项目路径修改   | 提供详细的修改方案文档 并为其做了一些改动 非常简单即可修改成自己想要的 |
   | 国际化         | 基于请求头动态返回不同语种的文本内容 开发难度低 有对应的工具类 支持大部分注解内容国际化 |
   | 代码单例测试   | 提供单例测试 使用方式编写方法与maven多环境单测插件           |

- websocket：netty
- api接口文档生成：Knife4j
- json序列化；Jackson

### 云服务

短信下发服务: 阿里云/华为/腾讯

系统推送服务： 

- 信鸽/极光 等第三方平台

- 优先自建通道 apns  firebase，时间不够就先用第三方



### 部署运维监控相关

服务器： 任意云EC2服务器 任意Linux发行版 Ubuntu或centos

容器化 docker

容器编排：k8s  弹性扩缩容

自动化打包CI/CD： Jenkins

日志管理:ELK (自建或使用云服务)

微服务健康监控:

服务器监控：

链路追踪：

dns解析： 腾讯dnspod

反向代理：nginx



## 运营管理系统（平台内部用）

框架：若依



## 租户运营管理系统（租户客户用）

框架：若依

## 音视频通话

### 一对一通话

- **技术**: 自主对接WebRTC
- **TURN服务**: Coturn
- **信令服务**: Java + WebSocket

### 多人音视频/多人会议

- **方案一**: LiveKit（基于Golang语言的开源SFU多人会议，研发投入高）
- **方案二**: 融云/声网等第三方平台（对接上线快，研发成本低）



