# 网关

## 建立Websocket连接



所有Websocket流量都经过此网关
所有客户端Websocket协议都是连接此网关
支持集群部署

## 详细内容

## 跨服务器消息路由方案:RPC和MQ对比

### RPC(指定服务器IP调用):

**优点**

- 使用Dubbo和Http等框架,采取点到点的方式调用到客户端连接的服务器,来进行消息转发

**缺点**

- 实现复杂,代码不易维护
- 需维护客户端连接数据到Redis等分布式缓存当中
- 需实现点到点调用的代码逻辑

### MQ:

**优点**

- 实现代码简洁,易维护
- 抗高并发
- 削峰填谷

**缺点**

- 内网服务器资源于带宽浪费:
  MQ将采用广播模式推送消息至所有Websocket网关,只有客户端连接的那一台服务器需要处理该消息,因此N-1台服务器都收到了无用的数据,收到后直接丢弃掉,但也会造成服务器处理器和内存的消耗

### 更好的方案

**RPC和MQ同时混合使用**

在正常情况下使用RPC调用下游服务器(Dubbo指定服务器IP调用).

但是在高峰时期,如下游服务器资源紧张,处理消息的速度跟不上,再使用MQ
